box: rocker/verse:latest
build:
  steps:
    - jimhester/r-dependencies
    - jimhester/r-check
    - jimhester/r-coverage
    - jimhester/r-lint

build-dev:
  box: rocker/verse:devel
  steps:
    - jimhester/r-dependencies
    - jimhester/r-check

deploy:
  steps:
    - add-to-known_hosts:
        hostname: ssh.github.com
        fingerprint: SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8
    - add-ssh-key:
        keyname: inlatools_ghpages
    - script:
      name: update pkgdown website
      code: |
        git clone --branch=gh-pages --depth=1 --single-branch git@github.com:inbo/inlatools.git /ghpages/docs
        rm -r /ghpages/docs/*
        Rscript -e 'install.packages("roxygen2")'
        Rscript -e "pkgdown::build_site()"
        cp -r docs /ghpages
        cd /ghpages/docs
        git config user.email "bmk@inbo.be"
        git config user.name "BMK by Wercker"
        git add --all
        git commit --amend -m "Update pkgdown website"
        git push --force origin
