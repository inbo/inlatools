---
title: "Setting a prior"
author: "Thierry Onkelinx"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Setting a prior}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(inlatools)
```

## "iid" random intercept

### Testing `sigma`

`simulate_iid()` generates a number of iid random intercepts from a Gaussian distribution with standard deviation `sigma`.

```{r}
x <- simulate_iid(sigma = 1)
y <- simulate_iid(sigma = 0.1)
```

`plot()` on the simulated random intercepts yields a density with indication of the quantiles.

```{r, fig.show='hold'}
plot(x)
plot(y)
```

Adding `link = "log"` displays the density after back transformation of the random intercepts using the log-link. The random intercept can be interpreted as a relative effect.

```{r, fig.show='hold'}
plot(x, link = "log")
plot(y, link = "log")
```

Adding `link = "logit"` displays the individual random intercepts after back transformation using the loglit-link. Since the influence of the random intercept depends on base proportion, the plot shows for each random intercept the resulting proportion after adding the random intercept to the base proportion.

```{r, fig.show='hold'}
plot(x, link = "logit")
plot(y, link = "logit")
```

### Testing `tau`

One can specify the precision `tau` ($\tau$) instead of the standard deviation `sigma` ($\sigma$). Note that the precision is the inverse of the variance ($\tau = 1 / \sigma ^ 2$).

```{r}
z <- simulate_iid(tau = 10)
plot(z)
```

You must either specify `sigma` or `tau`, the other must remain `NULL` (the default).

```{r error = TRUE}
simulate_iid(sigma = 0.1, tau = 100)
```

## First order random walk

```{r}
x <- simulate_rw(sigma = 0.1, length = 50)
y <- simulate_rw(sigma = 0.01, length = 50)
```

The default plot displays all simulated time series.

```{r, fig.show='hold'}
plot(x)
plot(y)
```

You can reduce the clutter by subsetting the time series. `select_quantile()` calculates the quantiles at each time step.

```{r, fig.show='hold'}
qx <- select_quantile(x) 
plot(qx)
qy <- select_quantile(y, quantiles = c(0.05, 0.3, 0.7, 0.95)) 
plot(qy)
```

For each simulated time series, we can calculate the strongest absolute effect at any time point. `select_divergence()` makes a subset of time series with the strongest absolute effect. 

```{r, fig.show='hold'}
plot(select_divergence(x))
plot(select_divergence(y, n = 20))
```

`select_change()` calculates the number of changes in direction of the time series. It will display the top simulated time series with the highest number of changes.

```{r, fig.show='hold'}
plot(select_change(x))
plot(select_change(y, n = 20))
```

`select_poly()` is useful in case you have a certain generic pattern in mind which can be described as a polynomial. 

```{r, fig.show='hold'}
plot(select_poly(x, coefs = -1))
plot(select_poly(y, coefs = 1, n = 20))
```
      
```{r, fig.show='hold'}
plot(select_poly(x, coefs = c(0, 1)))
plot(select_poly(y, coefs = c(0, -1), n = 20))
```

```{r, fig.show='hold'}
plot(select_poly(x, coefs = c(0, 0, -1)))
plot(select_poly(y, coefs = c(0, 0, 1), n = 20))
```

Back transformation is available for each `type` of plot. `link = "log"` back transforms from a log-link. The plot shows the relative effect of the random walk.

```{r, fig.show='hold'}
plot(qx, link = "log")
plot(qy, link = "log", baseline = 10)
```

The effect of the logit link depends on the base proportion. Therefore `link = "logit"` will create a subplot for 4 different base proportions: 5%, 10%, 25% and 50%.

```{r, fig.show='hold'}
plot(qx, link = "logit")
plot(qy, link = "logit", baseline = c(0.01, 0.0001, 0.98))
```

## Second order random walk

```{r}
x <- simulate_rw(sigma = 0.1, length = 50, order = 2)
y <- simulate_rw(sigma = 0.01, length = 50, order = 2)
```

```{r, fig.show='hold'}
qx <- select_quantile(x) 
plot(qx)
qy <- select_quantile(y, quantiles = c(0.05, 0.3, 0.7, 0.95)) 
plot(qy)
```

```{r, fig.show='hold'}
plot(select_divergence(x))
plot(select_divergence(y, n = 20))
```

```{r, fig.show='hold'}
plot(select_change(x))
plot(select_change(y, n = 20))
```

```{r, fig.show='hold'}
plot(select_poly(x, coefs = -1))
plot(select_poly(y, coefs = 1, n = 20))
```
      
```{r, fig.show='hold'}
plot(select_poly(x, coefs = c(0, 1)))
plot(select_poly(y, coefs = c(0, -1), n = 20))
```

```{r, fig.show='hold'}
plot(select_poly(x, coefs = c(0, 0, -1)))
plot(select_poly(y, coefs = c(0, 0, 1), n = 20))
```

```{r, fig.show='hold'}
plot(qx, link = "log")
plot(qy, link = "log", baseline = 10)
```

```{r, fig.show='hold'}
plot(qx, link = "logit")
plot(qy, link = "logit", baseline = c(0.01, 0.0001, 0.98))
```

