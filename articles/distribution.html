<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checking the distribution and dispersion of a model • inlatools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Checking the distribution and dispersion of a model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">inlatools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/distribution.html">Checking the distribution and dispersion of a model</a>
    </li>
    <li>
      <a href="../articles/prior.html">Setting a prior for the random intercept variance and fixed effects</a>
    </li>
    <li>
      <a href="../articles/rwprior.html">Getting a grasp on the random walk hyperparameter</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inbo/inlatools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Checking the distribution and dispersion of a model</h1>
                        <h4 class="author">Thierry Onkelinx</h4>
            
            <h4 class="date">2019-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inbo/inlatools/blob/master/vignettes/distribution.Rmd"><code>vignettes/distribution.Rmd</code></a></small>
      <div class="hidden name"><code>distribution.Rmd</code></div>

    </div>

    
    
<div id="generate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-data" class="anchor"></a>Generate data</h2>
<p>We created <code><a href="../reference/generate_data.html">generate_data()</a></code> to manufacture a basic data set with variables from different distributions: Poisson, negative binomial, binomial, zero inflated Poisson and zero inflated negative binomial. All variables share the common latent variable <code>eta</code> which is defined as <span class="math inline">\(\eta_{ij} = a + b_i\)</span> where <span class="math inline">\(b_i \sim \mathcal{N}(0, \sigma_r ^ 2)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tibble)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(INLA)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(inlatools)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">intercept &lt;-<span class="st"> </span><span class="dv">2</span>
sigma_random &lt;-<span class="st"> </span><span class="fl">0.75</span>
nb_size &lt;-<span class="st"> </span><span class="fl">0.5</span>

dataset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_data.html">generate_data</a></span>(
  <span class="dt">a =</span> intercept, <span class="dt">sigma_random =</span> sigma_random, <span class="dt">nb_size =</span> nb_size
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(dataset)
<span class="co">#&gt; Observations: 200</span>
<span class="co">#&gt; Variables: 9</span>
<span class="co">#&gt; $ group_id       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, ...</span>
<span class="co">#&gt; $ observation_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, ...</span>
<span class="co">#&gt; $ eta            &lt;dbl&gt; 1.776295, 1.618635, 2.315989, 1.824583, 2.63897...</span>
<span class="co">#&gt; $ zero_inflation &lt;lgl&gt; FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,...</span>
<span class="co">#&gt; $ poisson        &lt;int&gt; 2, 4, 8, 9, 13, 10, 3, 5, 5, 13, 8, 6, 29, 9, 2...</span>
<span class="co">#&gt; $ zipoisson      &lt;dbl&gt; 2, 0, 8, 9, 13, 10, 3, 0, 5, 0, 8, 0, 29, 0, 0,...</span>
<span class="co">#&gt; $ negbin         &lt;dbl&gt; 17, 0, 11, 0, 32, 3, 0, 6, 17, 1, 2, 0, 7, 1, 2...</span>
<span class="co">#&gt; $ zinegbin       &lt;dbl&gt; 17, 0, 11, 0, 32, 3, 0, 0, 17, 0, 2, 0, 7, 0, 0...</span>
<span class="co">#&gt; $ binom          &lt;int&gt; 4, 4, 4, 3, 4, 5, 4, 5, 4, 2, 5, 5, 5, 5, 5, 4,...</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(dataset)
<span class="co">#&gt;     group_id     observation_id        eta        zero_inflation </span>
<span class="co">#&gt;  Min.   : 1.00   Min.   :  1.00   Min.   :1.307   Mode :logical  </span>
<span class="co">#&gt;  1st Qu.: 5.75   1st Qu.: 50.75   1st Qu.:1.749   FALSE:101      </span>
<span class="co">#&gt;  Median :10.50   Median :100.50   Median :1.928   TRUE :99       </span>
<span class="co">#&gt;  Mean   :10.50   Mean   :100.50   Mean   :2.055                  </span>
<span class="co">#&gt;  3rd Qu.:15.25   3rd Qu.:150.25   3rd Qu.:2.304                  </span>
<span class="co">#&gt;  Max.   :20.00   Max.   :200.00   Max.   :3.099                  </span>
<span class="co">#&gt;     poisson         zipoisson         negbin         zinegbin    </span>
<span class="co">#&gt;  Min.   : 0.000   Min.   : 0.00   Min.   : 0.00   Min.   : 0.00  </span>
<span class="co">#&gt;  1st Qu.: 5.000   1st Qu.: 0.00   1st Qu.: 0.00   1st Qu.: 0.00  </span>
<span class="co">#&gt;  Median : 8.000   Median : 1.50   Median : 2.00   Median : 0.00  </span>
<span class="co">#&gt;  Mean   : 8.925   Mean   : 4.69   Mean   : 7.14   Mean   : 4.67  </span>
<span class="co">#&gt;  3rd Qu.:11.000   3rd Qu.: 8.00   3rd Qu.: 8.00   3rd Qu.: 3.00  </span>
<span class="co">#&gt;  Max.   :33.000   Max.   :29.00   Max.   :54.00   Max.   :54.00  </span>
<span class="co">#&gt;      binom     </span>
<span class="co">#&gt;  Min.   :2.00  </span>
<span class="co">#&gt;  1st Qu.:4.00  </span>
<span class="co">#&gt;  Median :5.00  </span>
<span class="co">#&gt;  Mean   :4.46  </span>
<span class="co">#&gt;  3rd Qu.:5.00  </span>
<span class="co">#&gt;  Max.   :5.00</span></code></pre></div>
</div>
<div id="overdispersion" class="section level2">
<h2 class="hasAnchor">
<a href="#overdispersion" class="anchor"></a>Overdispersion</h2>
<div id="fitting-the-models" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-the-models" class="anchor"></a>Fitting the models</h3>
<p>Data sets in ecology often exhibit overdispersion. Let’s take the <code>negbin</code> variable from the simulate data. This one has a negative binomial distribution. First we fit the models. Each model has the same covariate structure and the covariate structure is a perfect match with the data generating process. Note that we have to add <code>control.compute = list(config = TRUE)</code> to the <code><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla()</a></code> call for <code><a href="../reference/distribution_check.html">distribution_check()</a></code> and <code>control.predictor = list(compute = TRUE)</code> for the <code><a href="../reference/fast_distribution_check.html">fast_distribution_check()</a></code>. More details on the distinction between those functions will be in the following section.</p>
<p>We fit the model with three different distributions: 1) a negative binomial distribution, 2) a Poisson distribution, and 3) a Poisson distribution and a so called “observation level random effect” (OLRE).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">negbin_negbin_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  negbin <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"nbinomial"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
negbin_poisson_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  negbin <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"poisson"</span>,
  <span class="dt">control.compute =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">config =</span> <span class="ot">TRUE</span>),
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  negbin_negbin_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">distribution =</span> <span class="st">"negative binomial"</span>),
  negbin_poisson_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">distribution =</span> <span class="st">"Poisson"</span>)
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    distribution, parameter, mean, <span class="dt">lcl =</span> <span class="st">`</span><span class="dt">0.025quant</span><span class="st">`</span>, <span class="dt">ucl =</span> <span class="st">`</span><span class="dt">0.975quant</span><span class="st">`</span>
  ) -&gt;<span class="st"> </span>summary_fixed
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  negbin_negbin_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">distribution =</span> <span class="st">"negative binomial"</span>),
  negbin_poisson_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">distribution =</span> <span class="st">"Poisson"</span>)
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    distribution, parameter, mean, <span class="dt">lcl =</span> <span class="st">`</span><span class="dt">0.025quant</span><span class="st">`</span>, <span class="dt">ucl =</span> <span class="st">`</span><span class="dt">0.975quant</span><span class="st">`</span>
  ) -&gt;<span class="st"> </span>summary_hyper</code></pre></div>
<p>Once a model is fit, we can look at the summary. Both the negative binomial and the Poisson model do a good job when we look at the fixed effects estimates. Note that the true intercept is 2. Adding an observation level random effect to the Poisson model to compensate for overdispersion badly affects the fixed effects estimates.</p>
<table class="table">
<caption>Estimates of the fixed effect for the different models</caption>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">parameter</th>
<th align="right">mean</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">(Intercept)</td>
<td align="right">1.93</td>
<td align="right">1.58</td>
<td align="right">2.19</td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left">(Intercept)</td>
<td align="right">1.66</td>
<td align="right">1.28</td>
<td align="right">2.04</td>
</tr>
</tbody>
</table>
<p>We have set <span class="math inline">\(\sigma_r = 0.75\)</span>. This is equivalent with a precision of 1.778. All models seem to recover this precision reasonably well.</p>
<table class="table">
<caption>Hyperparameters of the different models</caption>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">parameter</th>
<th align="right">mean</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">size for the nbinomial observations (1/overdispersion)</td>
<td align="right">0.52</td>
<td align="right">0.41</td>
<td align="right">0.66</td>
</tr>
<tr class="even">
<td align="left">negative binomial</td>
<td align="left">Precision for group_id</td>
<td align="right">3.46</td>
<td align="right">1.01</td>
<td align="right">9.65</td>
</tr>
<tr class="odd">
<td align="left">Poisson</td>
<td align="left">Precision for group_id</td>
<td align="right">1.53</td>
<td align="right">0.72</td>
<td align="right">2.68</td>
</tr>
</tbody>
</table>
</div>
<div id="distribution-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#distribution-checks" class="anchor"></a>Distribution checks</h3>
<p>The main difference between <code><a href="../reference/distribution_check.html">distribution_check()</a></code> and <code><a href="../reference/fast_distribution_check.html">fast_distribution_check()</a></code> is that the latter is based on the fitted values while the former takes the marginal distribution of the fitted values into account. Hence, <code><a href="../reference/distribution_check.html">distribution_check()</a></code> is more accurate but takes about 10 to 20 times slower. Often the output of <code><a href="../reference/fast_distribution_check.html">fast_distribution_check()</a></code> is sufficient to highlight the worst problems.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(
  negbin_poisson_dc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distribution_check.html">distribution_check</a></span>(negbin_poisson_model)
)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(
  negbin_poisson_fdc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fast_distribution_check.html">fast_distribution_check</a></span>(negbin_poisson_model)
)</code></pre></div>
<p>Both <code><a href="../reference/distribution_check.html">distribution_check()</a></code> and <code>fast_distribution_check</code> return a data.frame with the empirical cumulative distribution of the raw data (<code>ecdf</code>) and the enveloppe of empirical cumalative distribution from data simulated from the model (<code>mean</code>, <code>lcl</code> and <code>ucl</code>). <code>n</code> is the number of observations with response <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(negbin_poisson_fdc)
<span class="co">#&gt; Observations: 43</span>
<span class="co">#&gt; Variables: 6</span>
<span class="co">#&gt; $ x      &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1...</span>
<span class="co">#&gt; $ median &lt;dbl&gt; 0.050, 0.140, 0.245, 0.335, 0.410, 0.480, 0.545, 0.600,...</span>
<span class="co">#&gt; $ lcl    &lt;dbl&gt; 0.025000, 0.105000, 0.205000, 0.295000, 0.370000, 0.440...</span>
<span class="co">#&gt; $ ucl    &lt;dbl&gt; 0.080, 0.180, 0.280, 0.375, 0.450, 0.520, 0.585, 0.645,...</span>
<span class="co">#&gt; $ n      &lt;dbl&gt; 59, 31, 14, 14, 10, 5, 6, 7, 6, 3, 2, 3, 1, 2, 1, 4, 1,...</span>
<span class="co">#&gt; $ ecdf   &lt;dbl&gt; 0.295, 0.450, 0.520, 0.590, 0.640, 0.665, 0.695, 0.730,...</span></code></pre></div>
<p>There is a <code><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot()</a></code> method for the distribution check data. It shows the ratio of the ecdf of the raw data devided by the ecdf of the simulated data based on the model. If the model makes sense, then the observed ecdf is within the enveloppe of the simulated ecdf. Hence the ratio observed / expected would be near to 1. This is the reference line depicted in the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(negbin_poisson_dc)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/negbin-poisson-dc-1.png" alt="Distribution check on a negative binomial response which is modelled using a Poisson distribution" width="576"><p class="caption">
Distribution check on a negative binomial response which is modelled using a Poisson distribution
</p>
</div>
<p>The plot from the <code><a href="../reference/distribution_check.html">distribution_check()</a></code> is very similar to that of the <code><a href="../reference/fast_distribution_check.html">fast_distribution_check()</a></code>. Notice that the ratio observed / expected is (much) larger than 1 for low values of <code>x</code>. The model with Poisson distribution doesn’t capture the low response values very well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(negbin_poisson_fdc)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/negbin-poisson-fdc-1.png" alt="Fast distribution check on a negative binomial response which is modelled using a Poisson distribution" width="576"><p class="caption">
Fast distribution check on a negative binomial response which is modelled using a Poisson distribution
</p>
</div>
<p>Let’s see what happens if we apply <code><a href="../reference/fast_distribution_check.html">fast_distribution_check()</a></code> on the model with negative binomial distribution and Poisson distribution with OLRE. The distribution check of the model with negative binomial distribution yields a plot where the enveloppe of the ratio observed vs expected is always very close to the reference (1).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">negbin_negbin_fdc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fast_distribution_check.html">fast_distribution_check</a></span>(negbin_negbin_model)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(negbin_negbin_fdc)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/negbin-negbin-fdc-1.png" alt="Fast distribution check on a negative binomial response which is modelled using a negative binomial distribution" width="576"><p class="caption">
Fast distribution check on a negative binomial response which is modelled using a negative binomial distribution
</p>
</div>
</div>
<div id="dispersion-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#dispersion-checks" class="anchor"></a>Dispersion checks</h3>
<p>The classics dispersion measure is to sum the squared Pearson residuals and devide them by the number of observations minus the degrees of freedom. This value should ideally be close to one. Values above one indicate overdispersion, while values below one indicate underdispersion.</p>
<p>The only aggreement there is on number the degrees of freedom of mixed models, is that is hard to define them in a generic way. Therefore we take the simulation approach. Suppose we calculate the dispersion <span class="math inline">\(D\)</span> as the sum of the squared Pearson residuals <span class="math inline">\(r_i\)</span> devided by the number of observations <span class="math inline">\(N\)</span> and some degrees of freedom <span class="math inline">\(x\)</span>. We calculate this value for the observed data (<span class="math inline">\(D|data\)</span>).</p>
<p><span class="math display">\[D = \frac{\sum r_i^2}{N - x}\]</span></p>
<p>Instead of comparing <span class="math inline">\(D|data\)</span> with some value, we simulate data from the model and for each of the simulated data sets we calculate the dispersion <span class="math inline">\((D|model)\)</span>. Next we compare the value <span class="math inline">\(D|data\)</span> with the distribution of <span class="math inline">\(D|model\)</span>. If there is no over- or underdispersion, <span class="math inline">\(P(D|data &lt; D|model) \approx 0.5\)</span>. When <span class="math inline">\(P(D|data &gt; D|model) \approx 0\)</span> indicates underdispersion, while <span class="math inline">\(P(D|data &gt; D|model) \approx 1\)</span> overdispersion.</p>
<p>Both <span class="math inline">\(D|data\)</span> and <span class="math inline">\(D|model\)</span> use the same values for <span class="math inline">\(N\)</span> and <span class="math inline">\(x\)</span>. Redefining <span class="math inline">\(D\)</span> as the average squared Pearson residuals <span class="math inline">\(D = \sum r_i^2/N\)</span>, has no effect on the value of <span class="math inline">\(P(D|data &gt; D|model)\)</span>. Hence can omit <span class="math inline">\(x\)</span> from the formula and no longer need to worry about its “true” value.</p>
<p><code><a href="../reference/dispersion_check.html">dispersion_check()</a></code> returns a list with two items: the dispersion value based on the data (a single value in <code>data</code>) and a vector of dispersion values for a number of simulated data sets (<code>model</code>). The <code><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot()</a></code> function as a method to handle this dispersion check object. It displays the density of the dispersion of the simulated data sets. The vertical dashed line shows the dispersion of the original data. The title contains <span class="math inline">\(P(D|data &gt; D|model)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">negbin_negbin_disp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(negbin_negbin_model)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(negbin_negbin_disp)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ data : num 0.995</span>
<span class="co">#&gt;  $ model: num [1:1000] 1.259 0.703 0.892 1.217 0.57 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr "dispersion_check"</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(negbin_negbin_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/negbin-negbin-disp-1.png" alt="Dispersion check on a negative binomial response which is modelled using a negative binomial distribution." width="576"><p class="caption">
Dispersion check on a negative binomial response which is modelled using a negative binomial distribution.
</p>
</div>
<p>The dispersion check of the model with the negative binomial distribution indicates no over- or underdispersion. The model with the Poisson distribution has clearly overdispersion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">negbin_poisson_disp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(negbin_poisson_model)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(negbin_poisson_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/negbin-poisson-disp-1.png" alt="Dispersion check on a negative binomial response which is modelled using a Poisson distribution." width="576"><p class="caption">
Dispersion check on a negative binomial response which is modelled using a Poisson distribution.
</p>
</div>
</div>
</div>
<div id="zero-inflation" class="section level2">
<h2 class="hasAnchor">
<a href="#zero-inflation" class="anchor"></a>Zero inflation</h2>
<p>Let’s see what happens if we do the same things for a zero inflated Poisson variable. We’ll fit the variable using a Poisson, negative binomial, zero inflated Poisson and zero inflated negative binomial distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pcprior &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">theta =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">prior =</span> <span class="st">"pc.prec"</span>, <span class="dt">param =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="fl">0.01</span>)))
zip_poisson_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  zipoisson <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>, <span class="dt">hyper =</span> pcprior), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"poisson"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
zip_negbin_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  zipoisson <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>, <span class="dt">hyper =</span> pcprior), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"nbinomial"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
zip_zipoisson_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  zipoisson <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>, <span class="dt">hyper =</span> pcprior), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"zeroinflatedpoisson1"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
zip_zinegbin_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  zipoisson <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>, <span class="dt">hyper =</span> pcprior), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"zeroinflatednbinomial1"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  zip_negbin_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"negative binomial"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">FALSE</span>
    ),
  zip_poisson_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"Poisson"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">FALSE</span>
    ),
  zip_zinegbin_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"negative binomial"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">TRUE</span>
    ),
  zip_zipoisson_model<span class="op">$</span>summary.fixed <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"Poisson"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">TRUE</span>
    )
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    distribution, zeroinflation, parameter, 
    mean, <span class="dt">lcl =</span> <span class="st">`</span><span class="dt">0.025quant</span><span class="st">`</span>, <span class="dt">ucl =</span> <span class="st">`</span><span class="dt">0.975quant</span><span class="st">`</span>
  ) -&gt;<span class="st"> </span>summary_zip_fixed
<span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  zip_negbin_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"negative binomial"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">FALSE</span>
    ),
  zip_poisson_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"Poisson"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">FALSE</span>
    ),
  zip_zinegbin_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"negative binomial"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">TRUE</span>
    ),
  zip_zipoisson_model<span class="op">$</span>summary.hyperpar <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"parameter"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="dt">distribution =</span> <span class="st">"Poisson"</span>,
      <span class="dt">zeroinflation =</span> <span class="ot">TRUE</span>
    )
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    distribution, zeroinflation, parameter, 
    mean, <span class="dt">lcl =</span> <span class="st">`</span><span class="dt">0.025quant</span><span class="st">`</span>, <span class="dt">ucl =</span> <span class="st">`</span><span class="dt">0.975quant</span><span class="st">`</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(parameter, distribution, zeroinflation) -&gt;<span class="st"> </span>summary_zip_hyper</code></pre></div>
<p>Using a distribution without zero inflation adds a downward bias to the intercept.</p>
<table class="table">
<caption>Estimates of the fixed effect for the different models</caption>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">zeroinflation</th>
<th align="left">parameter</th>
<th align="right">mean</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">FALSE</td>
<td align="left">(Intercept)</td>
<td align="right">1.47</td>
<td align="right">1.16</td>
<td align="right">1.78</td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left">FALSE</td>
<td align="left">(Intercept)</td>
<td align="right">1.31</td>
<td align="right">0.98</td>
<td align="right">1.62</td>
</tr>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">TRUE</td>
<td align="left">(Intercept)</td>
<td align="right">2.06</td>
<td align="right">1.84</td>
<td align="right">2.28</td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left">TRUE</td>
<td align="left">(Intercept)</td>
<td align="right">2.06</td>
<td align="right">1.84</td>
<td align="right">2.28</td>
</tr>
</tbody>
</table>
<p>We have set <span class="math inline">\(\sigma_r = 0.75\)</span>. This is equivalent with a precision of 1.778. All distributions lead to a large precision, so they all shrink the group effects. Note that the analyses are based on a very small dataset of only 200 observations and about half of them stem from the zero inflation part. The zero inflation probability is recorved very well. The size parameter of the negative binomial is very small when assuming no zero inflation. This indicates that it handles the zero inflation by increasing the variance. The zero inflated negative binomial has a very large size indicating that there is no overdispersion. Which is the case with a zero inflated Poisson response.</p>
<table class="table">
<caption>Hyperparameters of the different models</caption>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">zeroinflation</th>
<th align="left">parameter</th>
<th align="right">mean</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">FALSE</td>
<td align="left">Precision for group_id</td>
<td align="right">14.31</td>
<td align="right">1.99</td>
<td align="right">63.30</td>
</tr>
<tr class="even">
<td align="left">negative binomial</td>
<td align="left">TRUE</td>
<td align="left">Precision for group_id</td>
<td align="right">5.45</td>
<td align="right">2.47</td>
<td align="right">10.23</td>
</tr>
<tr class="odd">
<td align="left">Poisson</td>
<td align="left">FALSE</td>
<td align="left">Precision for group_id</td>
<td align="right">2.26</td>
<td align="right">1.10</td>
<td align="right">3.92</td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left">TRUE</td>
<td align="left">Precision for group_id</td>
<td align="right">5.38</td>
<td align="right">2.47</td>
<td align="right">10.03</td>
</tr>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">TRUE</td>
<td align="left">size for nbinomial zero-inflated observations</td>
<td align="right">846.44</td>
<td align="right">32.67</td>
<td align="right">5417.23</td>
</tr>
<tr class="even">
<td align="left">negative binomial</td>
<td align="left">FALSE</td>
<td align="left">size for the nbinomial observations (1/overdispersion)</td>
<td align="right">0.37</td>
<td align="right">0.28</td>
<td align="right">0.49</td>
</tr>
<tr class="odd">
<td align="left">negative binomial</td>
<td align="left">TRUE</td>
<td align="left">zero-probability parameter for zero-inflated nbinomial_1</td>
<td align="right">0.49</td>
<td align="right">0.42</td>
<td align="right">0.56</td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left">TRUE</td>
<td align="left">zero-probability parameter for zero-inflated poisson_1</td>
<td align="right">0.49</td>
<td align="right">0.42</td>
<td align="right">0.56</td>
</tr>
</tbody>
</table>
<div id="dispersion-checks-1" class="section level3">
<h3 class="hasAnchor">
<a href="#dispersion-checks-1" class="anchor"></a>Dispersion checks</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(zip_poisson_model) -&gt;<span class="st"> </span>zip_poisson_disp
<span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(zip_negbin_model) -&gt;<span class="st"> </span>zip_negbin_disp
<span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(zip_zipoisson_model) -&gt;<span class="st"> </span>zip_zipoisson_disp
<span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(zip_zinegbin_model) -&gt;<span class="st"> </span>zip_zinegbin_disp</code></pre></div>
<p>Using the Poisson distribution we get strong indications for overdispersion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(zip_poisson_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/zip-poisson-disp-1.png" alt="Dispersion check for a zero inflated Poisson reponse modelled with a Poisson distribution" width="576"><p class="caption">
Dispersion check for a zero inflated Poisson reponse modelled with a Poisson distribution
</p>
</div>
<p>The negative binomial distribution has a weak indication for underdispersion. More important, the range of dispersion values based on the simulation data is quite large.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(zip_negbin_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/zip-negbin-disp-1.png" alt="Dispersion check for a zero inflated Poisson reponse modelled with a negative binomial distribution" width="576"><p class="caption">
Dispersion check for a zero inflated Poisson reponse modelled with a negative binomial distribution
</p>
</div>
<p>The dispersion checks on both the zero inflation Poisson and the zero inflated negative binomial models give a go-ahead. The observed dispersion is well within the range of the dispersion of the simulated data and that range is quite narrow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(zip_zipoisson_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/zip-zipoisson-disp-1.png" alt="Dispersion check for a zero inflated Poisson reponse modelled with a zero inflated Poisson distribution" width="576"><p class="caption">
Dispersion check for a zero inflated Poisson reponse modelled with a zero inflated Poisson distribution
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(zip_zinegbin_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/zip-zinegbin-disp-1.png" alt="Dispersion check for a zero inflated Poisson reponse modelled with a zero inflated negative binomial distribution" width="576"><p class="caption">
Dispersion check for a zero inflated Poisson reponse modelled with a zero inflated negative binomial distribution
</p>
</div>
</div>
<div id="distribution-checks-1" class="section level3">
<h3 class="hasAnchor">
<a href="#distribution-checks-1" class="anchor"></a>Distribution checks</h3>
<p>Another feature of the distribution checks is that they can handle a list of models. The resulting data.frame gains a <code>model</code> variables which contains the name of the list (or their index in case of an unnamed list). Plotting the resulting check will create a subplot for each model (using <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>). By default all subplots will have the same scale. The strong ratio observed / expected for the Poisson model will swamp all information of the other models. Therefore we used <code>scales = "free"</code>, resulting in a dedicated x and y axis for each subplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
  <span class="dt">poisson =</span> zip_poisson_model,
  <span class="dt">negbin =</span> zip_negbin_model,
  <span class="dt">zipoisson =</span> zip_zipoisson_model,
  <span class="dt">zinegbin =</span> zip_zinegbin_model
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/fast_distribution_check.html">fast_distribution_check</a></span>() -&gt;<span class="st"> </span>zip_fdc</code></pre></div>
<p>The plot for the Poisson model clearly indicates a problem with the (near) zero values, the data has much more of those than the model predicts. The negative binomial models is better at modelling the large number of zero’s but it fails on the small, non-zero values which are overrepresented by the model. Both the zero inflated Poisson and the zero inflated negative binomial models pass the distribution check with flying colours.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(zip_fdc)
<span class="co">#&gt; Observations: 229</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ x      &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1...</span>
<span class="co">#&gt; $ median &lt;dbl&gt; 0.065, 0.190, 0.340, 0.475, 0.595, 0.690, 0.765, 0.820,...</span>
<span class="co">#&gt; $ lcl    &lt;dbl&gt; 0.035000, 0.145000, 0.290000, 0.425000, 0.550000, 0.640...</span>
<span class="co">#&gt; $ ucl    &lt;dbl&gt; 0.100000, 0.235000, 0.390000, 0.535000, 0.645000, 0.735...</span>
<span class="co">#&gt; $ n      &lt;dbl&gt; 99, 1, 4, 6, 7, 6, 9, 12, 9, 12, 7, 4, 4, 4, 1, 0, 0, 2...</span>
<span class="co">#&gt; $ ecdf   &lt;dbl&gt; 0.495, 0.500, 0.520, 0.550, 0.585, 0.615, 0.660, 0.720,...</span>
<span class="co">#&gt; $ model  &lt;chr&gt; "poisson", "poisson", "poisson", "poisson", "poisson", ...</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(zip_fdc, <span class="dt">scales =</span> <span class="st">"free"</span>)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/zip-fdc-1.png" alt="Fast distribution check on a zero inflated Poisson response which is modelled using several distributions" width="576"><p class="caption">
Fast distribution check on a zero inflated Poisson response which is modelled using several distributions
</p>
</div>
</div>
</div>
<div id="underdispersion" class="section level2">
<h2 class="hasAnchor">
<a href="#underdispersion" class="anchor"></a>Underdispersion</h2>
<p><code><a href="../reference/generate_data.html">generate_data()</a></code> has a binomial variable. We use this as an example for underdispersed data. The dispersion check clearly indicates underdispersion. The distribution check has a ratio smaller than 1 has low values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binom_poisson_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/inla">inla</a></span>(
  binom <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/INLA/topics/f">f</a></span>(group_id, <span class="dt">model =</span> <span class="st">"iid"</span>), 
  <span class="dt">data =</span> dataset, 
  <span class="dt">family =</span> <span class="st">"nbinomial"</span>,
  <span class="dt">control.predictor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">compute =</span> <span class="ot">TRUE</span>)
)
binom_poisson_disp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dispersion_check.html">dispersion_check</a></span>(binom_poisson_model)
binom_poisson_fdc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fast_distribution_check.html">fast_distribution_check</a></span>(binom_poisson_model)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(binom_poisson_disp)</code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/binom-poisson-disp-1.png" alt="Dispersion check on a binomial response which is modelled using a Poisson distribution." width="576"><p class="caption">
Dispersion check on a binomial response which is modelled using a Poisson distribution.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(binom_poisson_fdc)
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_path).</span></code></pre></div>
<div class="figure">
<img src="distribution_files/figure-html/binom-poisson-fdc-1.png" alt="Fast distribution check on a binomial response which is modelled using a negative binomial distribution" width="576"><p class="caption">
Fast distribution check on a binomial response which is modelled using a negative binomial distribution
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#generate-data">Generate data</a></li>
      <li><a href="#overdispersion">Overdispersion</a></li>
      <li><a href="#zero-inflation">Zero inflation</a></li>
      <li><a href="#underdispersion">Underdispersion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.muscardinus.be">Thierry Onkelinx</a>, <a href="https://www.inbo.be/en"><img src="https://inlatools.netlify.com/reference/figures/logo_en.png" height="24" alt="Research Institute for Nature and Forest"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
